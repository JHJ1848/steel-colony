# Steel Colony - 功能增加计划

## 项目当前状态总结

### 已完成的功能

1. **核心游戏功能**:
   - 3D 游戏场景和地形
   - 资源收集系统（木材、石头、食物、钢铁、铁矿、煤炭、石油）
   - 建筑建造系统（矿场、农场、工厂、仓库）
   - 建筑升级系统
   - 资源存储上限系统
   - 游戏目标系统
   - 胜利条件和游戏结束界面
   - 资源交易和转换系统

2. **视觉和动画效果**:
   - 抗锯齿和阴影效果
   - 建筑和资源的动画效果
   - 资源收集的粒子效果
   - 地形的细节和起伏

3. **用户界面**:
   - 资源面板显示
   - 建筑菜单
   - 游戏目标面板
   - 建筑详情菜单
   - 游戏设置界面
   - 游戏加载界面
   - 游戏结束界面
   - 资源交易界面
   - 游戏背景故事介绍

4. **系统功能**:
   - 游戏设置保存/加载
   - 游戏进度保存/加载
   - 响应式窗口调整
   - 通知系统

### 待实现的功能

1. **视角移动模块**:
   - WASD 键控制固定视角的移动
   - 视角边界控制

2. **对象表示重构**:
   - 每个对象用点表示，后续根据 id 外挂样式、贴图、动画等
   - 对象属性系统
   - 样式和动画系统

3. **游戏流程重构**:
   - 资源解锁系统
   - 科技树系统
   - 游戏进度跟踪

4. **UI 调整**:
   - 科技树界面
   - 资源解锁界面
   - 游戏进度界面

5. **性能优化**:
   - 渲染性能优化
   - 事件处理优化

## 功能增加计划

### [ ] 任务 1: 实现视角移动模块
- **优先级**: P0
- **依赖**: 无
- **描述**:
  - 添加键盘事件监听器，监听 WASD 键的按下和释放
  - 实现相机位置的移动逻辑，保持相机的固定视角（看向原点）
  - 添加移动速度控制，确保移动流畅自然
  - 设置相机移动的边界，防止相机移动到地图外
  - 添加相机高度限制，确保视角始终保持在合适的高度
- **成功标准**:
  - 玩家可以使用 WASD 键控制相机移动
  - 相机移动时保持固定视角
  - 相机不会移动到地图外
  - 移动速度适中，操作流畅
- **测试要求**:
  - `programmatic` TR-1.1: 按下 WASD 键时相机是否正确移动
  - `programmatic` TR-1.2: 相机移动是否有边界限制
  - `human-judgment` TR-1.3: 移动操作是否流畅自然
- **备注**: 移动速度应可通过设置调整

### [ ] 任务 2: 重构对象表示
- **优先级**: P0
- **依赖**: 任务 1
- **描述**:
  - 创建 GameObject 类，统一对象表示
  - 将所有 3D 模型替换为简单的点（使用 THREE.Points 或小型球体）
  - 为每个对象添加唯一 ID，用于后续的样式和动画绑定
  - 实现对象属性系统，支持存储对象的类型、状态、等级等信息
  - 设计基于对象 ID 的样式系统，支持后续添加贴图和模型
  - 实现基于对象 ID 的动画系统，支持后续添加动画效果
- **成功标准**:
  - 所有对象都用点表示，具有唯一 ID
  - 对象属性系统正常工作
  - 样式和动画系统可扩展
- **测试要求**:
  - `programmatic` TR-2.1: 对象是否正确创建和管理
  - `programmatic` TR-2.2: 对象属性是否可以正确存储和访问
  - `human-judgment` TR-2.3: 点对象的视觉效果是否清晰可辨
- **备注**: 保持对象的核心功能不变，只改变表示方式

### [ ] 任务 3: 实现资源解锁系统
- **优先级**: P1
- **依赖**: 任务 2
- **描述**:
  - 设计资源解锁树，定义资源解锁的顺序和条件
  - 实现资源解锁的逻辑和条件判断
  - 添加资源解锁的 UI 提示和反馈
  - 确保资源解锁系统与现有的资源管理系统集成
- **成功标准**:
  - 资源解锁系统正常工作
  - 解锁条件正确判断
  - UI 提示清晰明确
- **测试要求**:
  - `programmatic` TR-3.1: 资源解锁条件是否正确判断
  - `programmatic` TR-3.2: 解锁后的资源是否可以正常使用
  - `human-judgment` TR-3.3: 解锁提示是否清晰明确
- **备注**: 资源解锁顺序应合理，保持游戏的循序渐进

### [ ] 任务 4: 实现科技树系统
- **优先级**: P1
- **依赖**: 任务 3
- **描述**:
  - 设计科技树结构，定义科技的解锁顺序和效果
  - 实现科技研究的逻辑和资源消耗
  - 添加科技树的 UI 界面和交互
  - 确保科技树系统与现有的游戏系统集成
- **成功标准**:
  - 科技树系统正常工作
  - 科技研究逻辑正确
  - UI 界面美观易用
- **测试要求**:
  - `programmatic` TR-4.1: 科技研究功能是否正确实现
  - `programmatic` TR-4.2: 科技效果是否正确应用
  - `human-judgment` TR-4.3: 科技树界面是否美观易用
- **备注**: 科技树应与游戏的工业主题一致，提供有意义的升级选项

### [ ] 任务 5: 调整 UI 界面
- **优先级**: P2
- **依赖**: 任务 3, 任务 4
- **描述**:
  - 更新资源面板，显示资源解锁状态
  - 添加科技树界面
  - 添加游戏进度界面
  - 确保 UI 界面的一致性和美观性
- **成功标准**:
  - 资源面板显示正确
  - 科技树界面功能完整
  - 游戏进度界面信息清晰
- **测试要求**:
  - `human-judgment` TR-5.1: UI 界面是否美观一致
  - `human-judgment` TR-5.2: 界面操作是否直观易用
  - `programmatic` TR-5.3: 界面信息是否正确更新
- **备注**: UI 设计应保持未来科技感的视觉风格

### [ ] 任务 6: 性能优化
- **优先级**: P2
- **依赖**: 任务 2
- **描述**:
  - 优化点对象的渲染性能
  - 实现对象的可见性判断，只渲染可见的对象
  - 优化场景的渲染层次，提高渲染效率
  - 优化键盘事件的处理，减少事件处理的开销
  - 实现事件的节流和防抖，提高事件处理的效率
- **成功标准**:
  - 游戏帧率稳定在 60 FPS 以上
  - 事件处理响应迅速
  - 内存使用合理
- **测试要求**:
  - `programmatic` TR-6.1: 游戏帧率是否稳定在 60 FPS 以上
  - `programmatic` TR-6.2: 内存使用是否合理
  - `human-judgment` TR-6.3: 游戏运行是否流畅
- **备注**: 性能优化应在保证游戏功能的前提下进行

## 项目结构调整

```
steel-colony/
├── index.html          # 游戏主页面
├── game.js             # 游戏主逻辑
├── objects.js          # 对象定义和管理
├── unlock.js           # 解锁系统
├── tech-tree.js        # 科技树系统
├── ui.js               # UI 管理
├── assets/             # 游戏资源
│   ├── animations/     # 动画文件
│   ├── icons/          # 图标
│   └── images/         # 图片
├── css/                # 样式文件
│   ├── components/     # 组件样式
│   └── main.css        # 主样式
└── .trae/documents/    # 开发文档
    ├── steel_colony_plan.md            # 原始开发计划
    ├── steel_colony_refactor_plan.md   # 重构计划
    └── steel_colony_feature_enhancement_plan.md  # 功能增加计划
```

## 开发步骤

1. **步骤 1：实现视角移动模块**
   - 添加键盘事件监听器
   - 实现相机移动逻辑
   - 添加视角边界控制

2. **步骤 2：重构对象表示**
   - 创建 GameObject 类
   - 替换所有 3D 模型为点对象
   - 实现对象属性系统

3. **步骤 3：实现资源解锁系统**
   - 设计资源解锁树
   - 实现解锁条件检查
   - 添加解锁 UI 提示

4. **步骤 4：实现科技树系统**
   - 设计科技树结构
   - 实现科技研究逻辑
   - 添加科技树 UI 界面

5. **步骤 5：调整 UI 界面**
   - 更新资源面板
   - 添加科技树界面
   - 添加游戏进度界面

6. **步骤 6：性能优化**
   - 优化渲染性能
   - 优化事件处理
   - 测试和调试

## 预期成果

1. **视角移动**：玩家可以使用 WASD 键控制相机移动，保持固定视角
2. **对象表示**：所有对象都用点表示，具有唯一 ID 和属性系统
3. **游戏流程**：资源和建筑逐步解锁，游戏流程循序渐进
4. **科技树**：玩家可以研究科技，获得游戏优势
5. **UI 界面**：更新后的 UI 界面，显示资源解锁状态和科技树
6. **性能优化**：游戏运行流畅，响应迅速

## 后续扩展方向

1. **样式系统**：基于对象 ID 添加自定义样式和贴图
2. **动画系统**：基于对象 ID 添加动画效果
3. **多人游戏**：实现多人游戏功能
4. ** mod 支持**：添加 mod 支持，允许玩家自定义游戏内容
5. **更复杂的科技树**：扩展科技树，添加更多科技和升级选项
6. **敌人和防御系统**：添加敌人 AI 和防御建筑
7. **成就系统**：添加游戏成就和排行榜
8. **游戏难度级别**：添加简单、普通、困难模式

Steel Colony 将通过这些功能的增加，成为一个更加完整、有趣和具有深度的工业殖民地模拟游戏。